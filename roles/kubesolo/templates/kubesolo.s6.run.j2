#!/bin/execlineb -P
# KubeSolo s6 run script
# Generated by Ansible
# Place this file at /etc/s6/sv/kubesolo/run

# Set environment variables
{% if kubesolo_proxy %}
export HTTP_PROXY="{{ kubesolo_proxy }}"
export HTTPS_PROXY="{{ kubesolo_proxy }}"
export NO_PROXY="localhost,127.0.0.1,0.0.0.0,10.0.0.0/8,192.168.0.0/16"
{% endif %}

# Set ulimits
s6-softlimit -n 65535

# Execute kubesolo
exec {{ kubesolo_install_path }} \
  --path={{ kubesolo_path }} \
{% if kubesolo_apiserver_extra_sans | length > 0 %}
  --apiserver-extra-sans={{ kubesolo_apiserver_extra_sans | join(',') }} \
{% endif %}
{% if kubesolo_portainer_edge_id %}
  --portainer-edge-id={{ kubesolo_portainer_edge_id }} \
{% endif %}
{% if kubesolo_portainer_edge_key %}
  --portainer-edge-key={{ kubesolo_portainer_edge_key }} \
{% endif %}
{% if kubesolo_portainer_edge_async %}
  --portainer-edge-async \
{% endif %}
{% if kubesolo_local_storage %}
  --local-storage \
{% endif %}
{% if kubesolo_debug %}
  --debug \
{% endif %}
{% if kubesolo_pprof_server %}
  --pprof-server \
{% endif %}
  2>&1
